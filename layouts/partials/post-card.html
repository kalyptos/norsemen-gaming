{{/* Post Card – robust bildehåndtering (Resource | URL | Fallback) */}}
{{- $page := . -}}
{{- $cat := (index $page.Params.categories 0) | default "Ukategorisert" -}}

{{/* 1) .Params.featured in bundle  2) .Params.featured in assets  3) fallback */}}
{{- $imgRes := $page.Resources.GetMatch (or $page.Params.featured "feature*") -}}
{{- $imgURL := "" -}}
{{- $imgWidth := 800 -}}
{{- $imgHeight := 450 -}}

{{- if $imgRes -}}
  {{- if hugo.IsExtended -}}
    {{- $resized := $imgRes.Fill "800x450 q80" -}}
    {{- $imgURL = $resized.RelPermalink -}}
    {{- $imgWidth = $resized.Width -}}
    {{- $imgHeight = $resized.Height -}}
  {{- else -}}
    {{- $imgURL = $imgRes.RelPermalink -}}
  {{- end -}}
{{- else if $page.Params.featured -}}
  {{- $assetImg := resources.Get (printf "images/%s" $page.Params.featured) -}}
  {{- if $assetImg -}}
    {{- if hugo.IsExtended -}}
      {{- $resized := $assetImg.Fill "800x450 q80" -}}
      {{- $imgURL = $resized.RelPermalink -}}
      {{- $imgWidth = $resized.Width -}}
      {{- $imgHeight = $resized.Height -}}
    {{- else -}}
      {{- $imgURL = $assetImg.RelPermalink -}}
    {{- end -}}
  {{- else -}}
    {{- $imgURL = ($page.Params.featured | relURL) -}}
  {{- end -}}
{{- else -}}
  {{- $fallbackRes := resources.Get "images/feature-default.jpg" -}}
  {{- if $fallbackRes -}}
    {{- $imgURL = $fallbackRes.RelPermalink -}}
  {{- else -}}
    {{- $imgURL = ("/images/feature-default.jpg" | relURL) -}}
  {{- end -}}
{{- end -}}

<article class="post-card">
  <a href="{{ $page.Permalink }}" aria-label="Les mer om {{ $page.Title }}">
    <img
      class="card-thumb"
      loading="lazy"
      decoding="async"
      fetchpriority="low"
      src="{{ $imgURL }}"
      alt="{{ $page.Title }}"
      width="{{ $imgWidth }}"
      height="{{ $imgHeight }}">
  </a>

  <div class="card-content">
    <div class="card-header">
      <span class="inline-badge">{{ $cat }}</span>
      <div class="card-actions">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><path stroke="currentColor" stroke-width="1.6" d="M6 3h12a1 1 0 0 1 1 1v17l-7-4-7 4V4a1 1 0 0 1 1-1z"/></svg>
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><path stroke="currentColor" stroke-width="1.6" d="M20.8 8.6a5 5 0 0 0-8.1-3.8L12 5l-.7-.2A5 5 0 0 0 3.2 8.6c0 5.8 8.8 9.6 8.8 9.6s8.8-3.8 8.8-9.6z"/></svg>
      </div>
    </div>

    <h3 class="card-title">
      <a href="{{ $page.Permalink }}">{{ $page.Title }}</a>
    </h3>

    {{ with $page.Params.description }}
      <p class="card-desc">{{ . }}</p>
    {{ end }}

    <hr class="card-divider">

    <div class="card-footer">
      <div class="card-author">
        {{- $avatarRes := resources.Get "images/avatar-default.jpg" -}}
        {{- $avatarURL := "/images/avatar-default.jpg" -}}
        {{- if $avatarRes -}}
          {{- $avatarURL = $avatarRes.RelPermalink -}}
        {{- else if $page.Params.author_image -}}
          {{- $avatarURL = $page.Params.author_image -}}
        {{- end -}}
        <img src="{{ $avatarURL }}" alt="" class="author-avatar" aria-hidden="true">
        <div class="author-info">
          <div class="author-name">{{ $page.Params.author | default "Norsemen" }}</div>
          <time class="post-date" datetime="{{ $page.Date.Format "2006-01-02" }}">{{ $page.Date | time.Format "02. Jan 2006" }}</time>
        </div>
      </div>

      <a class="btn-read" href="{{ $page.Permalink }}" aria-label="Les full artikkel om {{ $page.Title }}">
        Les mer
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" aria-hidden="true"><path stroke="currentColor" stroke-width="2" d="M5 12h14M12 5l7 7-7 7"/></svg>
      </a>
    </div>
  </div>
</article>
