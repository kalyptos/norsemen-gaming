<!-- layouts/partials/head.html -->
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="robots" content="index, follow" />
  <meta name="theme-color" content="#0b1220" />
  <meta name="color-scheme" content="dark" />

  <title>{{ if .IsHome }}{{ .Site.Title }}{{ else }}{{ .Title }} Â· {{ .Site.Title }}{{ end }}</title>
  <meta name="description" content="{{ with .Description }}{{ . | plainify | truncate 160 }}{{ else }}{{ with .Summary }}{{ . | plainify | truncate 160 }}{{ else }}{{ .Site.Params.description }}{{ end }}{{ end }}" />
  <link rel="canonical" href="{{ .Permalink }}" />

  {{/* Favicon */}}
  <link rel="icon" type="image/x-icon" href="{{ .Site.Params.favicon | default "/favicon.ico" }}" />
  <link rel="apple-touch-icon" href="{{ "/apple-touch-icon.png" | relURL }}" />

  {{/* RSS Feed */}}
  {{ with .OutputFormats.Get "RSS" }}
  <link rel="alternate" type="application/rss+xml" title="{{ $.Site.Title }}" href="{{ .Permalink }}" />
  {{ end }}

  {{/* Manifest for PWA */}}
  <link rel="manifest" href="{{ "/manifest.json" | relURL }}" />

  <!-- Open Graph -->
  <meta property="og:title" content="{{ if .IsHome }}{{ .Site.Title }}{{ else }}{{ .Title }}{{ end }}" />
  <meta property="og:description" content="{{ with .Description }}{{ . | plainify | truncate 160 }}{{ else }}{{ with .Summary }}{{ . | plainify | truncate 160 }}{{ else }}{{ .Site.Params.description }}{{ end }}{{ end }}" />
  <meta property="og:type" content="{{ if .IsHome }}website{{ else }}article{{ end }}" />
  <meta property="og:url" content="{{ .Permalink }}" />
  <meta property="og:site_name" content="{{ .Site.Title }}" />
  <meta property="og:locale" content="no_NO" />

  {{/* Article-specific OG tags */}}
  {{ if not .IsHome }}
  <meta property="article:published_time" content="{{ .Date.Format "2006-01-02T15:04:05Z07:00" }}" />
  <meta property="article:modified_time" content="{{ .Lastmod.Format "2006-01-02T15:04:05Z07:00" }}" />
  <meta property="article:author" content="{{ .Params.author | default .Site.Params.author }}" />
  {{ range .Params.tags }}
  <meta property="article:tag" content="{{ . }}" />
  {{ end }}
  {{ end }}

  {{/* OG/Twitter Images with AVIF/WebP support */}}
  {{ with .Params.featured }}
    {{ $img := or ($.Resources.GetMatch .) (resources.Get (printf "images/%s" .)) }}
    {{ with $img }}
      {{ if hugo.IsExtended }}
        {{ $avif := .Fill "1200x630 avif q80" }}
        {{ $webp := .Fill "1200x630 webp q75" }}
        <meta property="og:image" content="{{ $avif.Permalink }}" />
        <meta property="og:image:secure_url" content="{{ $avif.Permalink }}" />
        <meta property="og:image:width" content="1200" />
        <meta property="og:image:height" content="630" />
        <meta property="og:image:alt" content="{{ $.Title }}" />
        <meta property="og:image:type" content="image/avif" />
        <meta name="twitter:image" content="{{ $webp.Permalink }}" />
        <meta name="twitter:image:alt" content="{{ $.Title }}" />
        <link rel="preload" as="image" type="image/avif" href="{{ $avif.Permalink }}" />
      {{ else }}
        <meta property="og:image" content="{{ .Permalink }}" />
        <meta name="twitter:image" content="{{ .Permalink }}" />
      {{ end }}
    {{ end }}
  {{ end }}

  <!-- Twitter Card -->
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:title" content="{{ if .IsHome }}{{ .Site.Title }}{{ else }}{{ .Title }}{{ end }}" />
  <meta name="twitter:description" content="{{ with .Description }}{{ . | plainify | truncate 160 }}{{ else }}{{ with .Summary }}{{ . | plainify | truncate 160 }}{{ else }}{{ .Site.Params.description }}{{ end }}{{ end }}" />

  {{/* CSS Bundle with SRI */}}
  {{ $vars := resources.Get "css/variables.css" }}
  {{ $base := resources.Get "css/base.css" }}
  {{ $layout := resources.Get "css/layout.css" }}
  {{ $components := resources.Get "css/components.css" }}
  {{ $blog := resources.Get "css/blog.css" }}
  {{ $animations := resources.Get "css/animations.css" }}
  {{ $bundle := slice $vars $base $layout $components $blog $animations | resources.Concat "css/app.css" | resources.Minify | fingerprint }}
  <link rel="stylesheet" href="{{ $bundle.RelPermalink }}" integrity="{{ $bundle.Data.Integrity }}" crossorigin="anonymous" />
  <link rel="preload" href="{{ $bundle.RelPermalink }}" as="style" />
</head>